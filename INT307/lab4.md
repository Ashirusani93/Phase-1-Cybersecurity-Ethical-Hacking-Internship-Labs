

# INT307 Web Application Security Lab 4: File Upload Vulnerabilities in DVWA

## Overview

In this lab, you will explore file upload vulnerabilities within the Damn Vulnerable Web Application (DVWA). File upload vulnerabilities occur when an application allows users to upload files without proper validation, enabling attackers to upload malicious files that can compromise the system. You will utilize **Weevely** to generate a PHP reverse shell and **Burp Suite** to manipulate requests and bypass validation checks across different security levels (Low, Medium, and High).

### Prerequisites

- Ensure you have DVWA installed and running.
- Familiarize yourself with **Weevely** and its functionality.
- Basic understanding of **Burp Suite** and how to intercept and modify HTTP requests.

---

## Exercise Instructions

### **Exercise 1: Exploring the File Upload Page**

**Objective:** Understand the file upload functionality in DVWA.

1. **Access the File Upload Page**: Navigate to the following URL in your DVWA instance:
   - [File Upload](http://localhost/DVWA/vulnerabilities/upload/)

2. **Analyze the Upload Form**:
   - Review the form provided for file uploads. Identify the input fields and their types.

3. **Upload a Non-Malicious File**:
   - Select a harmless file (e.g., a text file named `test.txt`) and upload it to the server.
   - Observe the response and verify that the file was uploaded successfully.

4. **Reflection**:
   - What are the characteristics of the file upload feature? Discuss any visible restrictions (if any) on file types and sizes.

---

### **Exercise 2: Generate a PHP Shell Using Weevely**

**Objective:** Create a malicious file using Weevely.

1. **Install Weevely** (if not already installed):
   - Open a terminal and clone the Weevely repository:
   ```bash
   git clone https://github.com/epinna/weevely3.git
   cd weevely3
   ```

2. **Generate a PHP Shell**:
   - Run Weevely to create a PHP reverse shell:
   ```bash
   python weevely3.py generate your_password shell.php
   ```
   - Replace `your_password` with a secure password. This will create a file named `shell.php`.

3. **Review the Shell Code**:
   - Open `shell.php` in a text editor and observe the code generated by Weevely.

---

### **Exercise 3: Upload the Malicious Shell at Different Security Levels**

**Objective:** Identify and exploit a file upload vulnerability by uploading the generated shell at various security levels.

#### **Step 1: Low Security Level**

1. **Set Security Level to Low**:
   - In DVWA, navigate to the security settings and set the security level to **Low**.

2. **Upload the Malicious Shell**:
   - Go back to the file upload page.
   - Use the upload form to upload the `shell.php` file created by Weevely.
   - Observe if the upload is successful.

3. **Reflection**:
   - Were you able to upload the malicious file? Discuss the implications of this vulnerability.

---

#### **Step 2: Medium Security Level**

1. **Set Security Level to Medium**:
   - Change the security level to **Medium** in DVWA.

2. **Upload Attempt**:
   - Try uploading the `shell.php` file again. 
   - If the upload fails due to validation, proceed to use Burp Suite to bypass validation.

3. **Bypassing Validation with Burp Suite**:
   - Start Burp Suite and configure your browser to use Burp as a proxy.
   - Intercept the upload request when you attempt to upload the file.
   - Modify the request to change the file type in the headers (e.g., change the content type to `image/jpeg`).
   - Forward the request to the server and observe the response.

4. **Reflection**:
   - Were you able to bypass the restrictions? What does this indicate about the application's security?

---

#### **Step 3: High Security Level**

1. **Set Security Level to High**:
   - Change the security level to **High** in DVWA.

2. **Upload Attempt**:
   - Again, try uploading the `shell.php` file. 
   - If the upload is blocked, use Burp Suite as before to intercept and modify the upload request.

3. **Bypassing Validation**:
   - Intercept the request and change necessary parameters, such as the filename and content type.
   - Forward the modified request and check the response.

4. **Reflection**:
   - Discuss whether you could upload the shell at this security level and the effectiveness of security measures.

---

### **Exercise 4: Accessing the Uploaded Shell**

**Objective:** Execute the uploaded shell and gain access to the web server.

1. **Locate the Uploaded Shell**:
   - Find the URL for the uploaded shell. It should be similar to:
   ```
   http://localhost/DVWA/hackable/uploads/shell.php
   ```

2. **Access the Shell**:
   - Open the URL in a web browser. You should see a prompt asking for the password.

3. **Use the Password**:
   - Enter the password you set during shell generation. If successful, you will access the Weevely shell.

4. **Reflection**:
   - What functionalities does the shell provide? Discuss the implications of being able to execute commands on the server.

---

### **Exercise 5: Understanding Security Measures**

**Objective:** Examine the effectiveness of security measures against file upload vulnerabilities.

1. **Test Application Security**:
   - Review the settings in DVWA and try to repeat the previous exercises (upload a malicious file, bypass restrictions) under each security level.

2. **Analyze Outcomes**:
   - Document whether the application allowed or blocked the file uploads under different security levels and how Burp Suite was utilized.

3. **Reflection**:
   - Discuss how security measures (like file type validation, size restrictions, etc.) can prevent file upload vulnerabilities.

---

## Lab Report

### **Student Information**

- **Name:** [Your Name]  
- **Student ID:** [Your ID]  
- **Date:** [Date of Lab]  

### **Exercise Summaries**

For each exercise, please summarize your findings below.

#### **Exercise 1 Summary**
- **Observations:**
  - [Document your observations about the upload form]
- **Characteristics:**
  - [Discuss any restrictions you noticed]

---

#### **Exercise 2 Summary**
- **Shell Generation Outcome:**
  - [Was the malicious shell created successfully?]
- **Observations:**
  - [Discuss the code and functionality of the generated shell]

---

#### **Exercise 3 Summary**
- **Low Security Level:**
  - **Upload Outcome:** [Was the malicious file uploaded successfully?]
  - **Implications:** [Discuss the implications of this vulnerability]
  
- **Medium Security Level:**
  - **Upload Outcome:** [Were you able to bypass restrictions using Burp Suite?]
  - **Discussion:** [Discuss the effectiveness of security measures]
  
- **High Security Level:**
  - **Upload Outcome:** [Were you able to bypass restrictions using Burp Suite?]
  - **Discussion:** [Discuss the effectiveness of security measures]

---

#### **Exercise 4 Summary**
- **Shell Access Outcome:**
  - [Were you able to access the shell?]
- **Discussion:**
  - [Reflect on the capabilities of the shell and what access it grants]

---

#### **Exercise 5 Summary**
- **Security Measures Outcome:**
  - [Were you able to bypass security measures?]
- **Discussion:**
  - [Discuss the effectiveness of the security measures in preventing file upload vulnerabilities]

---

## Conclusion

In this lab, you have learned about file upload vulnerabilities, how they can be exploited, and the importance of implementing strict validation and sanitization measures to secure web applications against such attacks. You also explored the functionality of **Weevely** as a tool for creating backdoors in vulnerable applications and used **Burp Suite** to manipulate requests to bypass security validations.

### **Submission Instructions**
- Complete your lab report and submit 

---

Feel free to customize any sections further or let me know if you need additional changes!